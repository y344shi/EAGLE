<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg">
  <style>
    .title { font: bold 24px sans-serif; }
    .subtitle { font: bold 18px sans-serif; }
    .label { font: 14px sans-serif; }
    .small { font: 12px sans-serif; }
    .box { fill: #f0f0f0; stroke: #333; stroke-width: 2; }
    .highlight { fill: #d0e0ff; }
    .process { fill: #ffe0d0; }
    .data { fill: #d0ffe0; }
    .arrow { stroke: #333; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
    .dashed { stroke-dasharray: 5,5; }
  </style>
  
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="400" y="30" class="title" text-anchor="middle">Triton Drafter Data Flow</text>
  
  <!-- Input Features -->
  <rect x="50" y="70" width="200" height="60" class="box data" rx="5" ry="5" />
  <text x="150" y="105" class="label" text-anchor="middle">Input Features</text>
  <text x="150" y="125" class="small" text-anchor="middle">(Low/Mid/High Taps)</text>
  
  <!-- Optional FC Align -->
  <rect x="300" y="70" width="200" height="60" class="box process" rx="5" ry="5" />
  <text x="400" y="105" class="label" text-anchor="middle">Optional FC Align</text>
  <text x="400" y="125" class="small" text-anchor="middle">(3*H → H_ea)</text>
  
  <!-- Hidden State -->
  <rect x="550" y="70" width="200" height="60" class="box data" rx="5" ry="5" />
  <text x="650" y="105" class="label" text-anchor="middle">Hidden State</text>
  <text x="650" y="125" class="small" text-anchor="middle">(H_ea)</text>
  
  <!-- QKV Projection -->
  <rect x="50" y="170" width="200" height="60" class="box process" rx="5" ry="5" />
  <text x="150" y="205" class="label" text-anchor="middle">QKV Projection</text>
  <text x="150" y="225" class="small" text-anchor="middle">(Wq, Wk, Wv)</text>
  
  <!-- ROPE -->
  <rect x="300" y="170" width="200" height="60" class="box process" rx="5" ry="5" />
  <text x="400" y="205" class="label" text-anchor="middle">ROPE</text>
  <text x="400" y="225" class="small" text-anchor="middle">(Position Embeddings)</text>
  
  <!-- KV Cache -->
  <rect x="550" y="170" width="200" height="60" class="box data" rx="5" ry="5" />
  <text x="650" y="205" class="label" text-anchor="middle">KV Cache</text>
  <text x="650" y="225" class="small" text-anchor="middle">(Store K,V for ancestors)</text>
  
  <!-- Tree Attention -->
  <rect x="175" y="270" width="200" height="60" class="box process highlight" rx="5" ry="5" />
  <text x="275" y="305" class="label" text-anchor="middle">Tree Attention</text>
  <text x="275" y="325" class="small" text-anchor="middle">(FlashAttention-style)</text>
  
  <!-- Attention Output -->
  <rect x="425" y="270" width="200" height="60" class="box data" rx="5" ry="5" />
  <text x="525" y="305" class="label" text-anchor="middle">Attention Output</text>
  <text x="525" y="325" class="small" text-anchor="middle">(+ Residual)</text>
  
  <!-- RMSNorm -->
  <rect x="175" y="370" width="200" height="60" class="box process" rx="5" ry="5" />
  <text x="275" y="405" class="label" text-anchor="middle">RMSNorm</text>
  
  <!-- MLP -->
  <rect x="425" y="370" width="200" height="60" class="box process" rx="5" ry="5" />
  <text x="525" y="405" class="label" text-anchor="middle">MLP</text>
  <text x="525" y="425" class="small" text-anchor="middle">(SwiGLU + Residual)</text>
  
  <!-- LM Head -->
  <rect x="300" y="470" width="200" height="60" class="box process highlight" rx="5" ry="5" />
  <text x="400" y="505" class="label" text-anchor="middle">LM Head + Streaming Top-K</text>
  <text x="400" y="525" class="small" text-anchor="middle">(Blockwise Matmul)</text>
  
  <!-- Global Prune -->
  <rect x="300" y="570" width="200" height="60" class="box process highlight" rx="5" ry="5" />
  <text x="400" y="605" class="label" text-anchor="middle">Global K-way Prune</text>
  <text x="400" y="625" class="small" text-anchor="middle">(Select top-K from K*TOPK)</text>
  
  <!-- Tree Metadata -->
  <rect x="50" y="470" width="200" height="160" class="box data" rx="5" ry="5" />
  <text x="150" y="495" class="label" text-anchor="middle">Tree Metadata</text>
  <text x="150" y="520" class="small" text-anchor="middle">• Position IDs</text>
  <text x="150" y="540" class="small" text-anchor="middle">• Parents</text>
  <text x="150" y="560" class="small" text-anchor="middle">• Frontier Indices</text>
  <text x="150" y="580" class="small" text-anchor="middle">• Scores</text>
  <text x="150" y="600" class="small" text-anchor="middle">• Next Frontier</text>
  
  <!-- Next Frontier -->
  <rect x="550" y="470" width="200" height="160" class="box data" rx="5" ry="5" />
  <text x="650" y="495" class="label" text-anchor="middle">Candidate Tokens</text>
  <text x="650" y="520" class="small" text-anchor="middle">• Top-K per parent</text>
  <text x="650" y="540" class="small" text-anchor="middle">• Token IDs</text>
  <text x="650" y="560" class="small" text-anchor="middle">• Scores</text>
  <text x="650" y="580" class="small" text-anchor="middle">• Parent Indices</text>
  <text x="650" y="600" class="small" text-anchor="middle">• Selected Frontier</text>
  
  <!-- Arrows -->
  <path d="M250,100 L300,100" class="arrow" />
  <path d="M500,100 L550,100" class="arrow" />
  <path d="M650,130 L650,170" class="arrow" />
  <path d="M650,130 L150,170" class="arrow" />
  <path d="M250,200 L300,200" class="arrow" />
  <path d="M500,200 L550,200" class="arrow" />
  <path d="M150,230 L150,300 L175,300" class="arrow" />
  <path d="M550,230 L550,300 L375,300" class="arrow" />
  <path d="M375,300 L425,300" class="arrow" />
  <path d="M525,330 L525,370" class="arrow" />
  <path d="M275,330 L275,370" class="arrow" />
  <path d="M375,400 L425,400" class="arrow" />
  <path d="M525,430 L400,470" class="arrow" />
  <path d="M400,530 L400,570" class="arrow" />
  <path d="M250,550 L300,600" class="arrow" />
  <path d="M500,600 L550,550" class="arrow" />
  
  <!-- Depth Loop -->
  <path d="M50,350 C30,350 30,500 50,500" class="arrow dashed" />
  <text x="20" y="425" class="label" text-anchor="middle" transform="rotate(270,20,425)">Depth Loop</text>
</svg>